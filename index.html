<!doctype html>
<html lang="en">
    <head>
	<meta charset="UTF-8" />
	<title>WindowOnEnterFrameEvent</title>
	<script type="text/javascript">
	    (function(_import) {
		"use strict";
		var _context = {
		    requestAF: function() {
			return window.requestAnimationFrame ||
				window.mozRequestAnimationFrame ||
				window.webkitRequestAnimationFrame ||
				window.msRequestAnimationFrame;
		    },
		    perfTM: function() {
			var performance = window.performance || {};
			return performance.now() ||
				performance.mozNow() ||
				performance.msNow() ||
				performance.oNow() ||
				performance.webkitNow();
		    }
		};
		var _export = function() {
		};
		_export.fn = _export.prototype;

		_export.fn.frameRate = 30;
		_export.fn.frameNumber = 0;
		_export.fn.interValHandle = "";
		_export.fn.enterframeEventQue = {};
		_export.fn.onEnterFrame = function(handle, func, callback, params) {

		    var _handle = handle || "default";
		    this.enterframeEventQue[_handle] = func;
		    if (callback)
			callback(params);
		    return this;
		};
		_export.fn.deleteEnterFrame = function(handle, callback) {
		    var _handle = handle || "default";
		    delete this.enterframeEventQue[_handle];
		    if (callback)
			callback();
		    return this;
		};

		_export.fn.setFrameRate = function(framerate) {
		    if (framerate < 1) {
			framerate = 1;
		    } else if (framerate > 60) {
			framerate = 60;
		    }
		    this.frameRate = framerate;
		    this.restartFrame();
		    return this;
		};
		_export.fn.getInterval = function() {
		    var interval = (1000 / this.frameRate);
		    return interval;
		};
		_export.fn.getFrameNumber = function() {
		    return this.frameNumber;
		};
		_export.fn.getFrame = function() {
		    return this.frameRate;
		};
		_export.fn.restartFrame = function() {
		    clearInterval(this.interValHandle);
		    this.atuoPublish();
		};
		_export.fn.updateFrameNumber = function() {
		    this.frameNumber++;
		    if (this.frameNumber > 1000) {
			//console.clear();
		    }
		    return this;
		};
		_export.fn.atuoPublish = function() {

		    var that = this;

		    this.interValHandle = setInterval(function() {
			that.updateFrameNumber();


			for (var i in that.enterframeEventQue) {

			    var enventParam = {
				frame: that.getFrameNumber(),
				handle: i,
				eventTime: new Date().getTime(),
				readableEventTime: (function() {
				    var date = new Date();
				    return  date.getHours() + ":"
					    + date.getMinutes() + ":"
					    + date.getSeconds() + ":"
					    + date.getMilliseconds() + ":"
					    + _context.perfTM();
				}()),
				source: that.enterframeEventQue[i].toString(),
				toString: function() {
				    return "Current frame: " + this.frame + " Timeline: " + this.readableEventTime;
				}
			    };


			    that.enterframeEventQue[i](enventParam);
			}

		    }, this.getInterval());
		    return this;
		};
		_export.fn.extend = function(classFunc) {
		    if (!!(classFunc && classFunc.constructor && classFunc.call && classFunc.apply)) {

			classFunc.prototype = new _export();
			return this;
		    } else {
			throw "you can only extend class";
		    }
		};

		_import.prototype.frameEvent = new _export();
		window.requestAnimationFrame = _context.requestAF();
		window.frameEvent.atuoPublish();

	    }(Window));
	</script>

	<script type="text/javascript">
	    /*
	     * Gio = (Aaron Goshine); 
	     */
	    var callback = function() {
		console.log("Call back");
	    };
	    var eventHandler = function(event) {
		var windowframe = document.getElementById("windowFrame");
		windowframe.innerHTML = event.toString();

	    };


	    var classFuncEventHandler = function(event) {
		var classFrames = document.getElementById("classFrames");
		classFrames.innerHTML = event.toString();
	    };

	    window.onload = function() {

		// frameEvent can becalled on the window by deafult
		window.frameEvent.onEnterFrame("handleFrameOnWindow", eventHandler, callback);
		window.frameEvent.setFrameRate(12);
		//frameEvent.deleteEnterFrame ("handleFrameOnWindow", callback);

		//Runing at different framrate
		/*
		 * You can set up a a custom extention
		 * to add frameEvent to a classFunction
		 */
		var Class = function() {
		    this.frameRate = 0;
		    this.frameNumber = 0;
		    this.interValHandle = "";
		    this.enterframeEventQue = {};
		};
		//window will extend your class peacefull
		window.frameEvent.extend(Class);
		var instance = new Class();
		instance.setFrameRate(60);
		instance.onEnterFrame("handleFrameOnClassFunc", classFuncEventHandler);
		//frameEvent.deleteEnterFrame ("handleFrameOnClassFunc");



	    };

	</script>
	<style>
	    *{
		font-family: arial;
		color: gray;
	    }
	    .console{

		font-size: 24px;
		margin-bottom: 40px;
	    }
	</style>
    </head>
    <body >
	<h2> 12 frames per seconds </h2>
	<div class="console" id="windowFrame">
	</div>
	<hr/>
	<h2> 60 frames per seconds </h2>
	<div class ="console" id="classFrames">
	</div>

    </body>
</html>
