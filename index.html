<!doctype html>
<html lang="en">
    <head>
	<meta charset="UTF-8" />
	<title>onEnterFramejs</title>
	<script type="text/javascript">
	    (function(_import) {
		"use strict";
		var _requestAF = window.requestAnimationFrame ||
			window.mozRequestAnimationFrame ||
			window.webkitRequestAnimationFrame ||
			window.msRequestAnimationFrame;
		var DEFAULT = "default";
		var DEFAULTFRM = -1;
		var ERROMESSAGE = "you can only extend classes";

		var _export = function() {
		    this.frameRate = DEFAULTFRM;
		    this.lastTime = 0;
		    this.frameNumber = 0;
		    this.interValHandle = "";
		    this.enterframeEventQue = {};
		    this.atuoPublish();
		};
		_export.fn = _export.prototype;
		_export.fn.onEnterFrame = function(handle, func, callback, params) {
		    var _handle = handle || DEFAULT;
		    this.enterframeEventQue[_handle] = func;
		    if (callback)
			callback(params);
		    return this;
		};
		_export.fn.deleteEnterFrame = function(handle, callback) {
		    var _handle = handle || DEFAULT;
		    delete this.enterframeEventQue[_handle];
		    if (callback)
			callback();
		    return this;
		};

		_export.fn.setFrameRate = function(framerate) {
		    if (framerate < 1) {
			framerate = DEFAULTFRM;
		    } else if (framerate > 60) {
			framerate = 60;
		    }
		    this.frameRate = framerate;

		    this.restartFrame();
		    return this;
		};
		_export.fn.getInterval = function() {
		    var interval = (1000 / this.frameRate);
		    return interval;
		};
		_export.fn.getFrameNumber = function() {
		    return this.frameNumber;
		};
		_export.fn.getFrame = function() {
		    return this.frameRate;
		};
		_export.fn.restartFrame = function() {
		    clearInterval(this.interValHandle);
		    this.atuoPublish();
		};
		_export.fn.updateFrameNumber = function() {
		    this.frameNumber++;
		    if (this.frameNumber > 1000) {

		    }
		    return this;
		};
		_export.fn.atuoPublish = function() {

		    var that = this;
		    var step = function() {
			that.updateFrameNumber();
			// console.log(that.frameRate);
			var eventTimeStamp = new Date().getTime();
			for (var i in that.enterframeEventQue) {
			    var enventParam = {
				frame: that.getFrameNumber(),
				handle: i,
				eventTime: eventTimeStamp,
				lastTime: that.lastTime,
				readableEventTime: eventTimeStamp,
				source: that.enterframeEventQue[i].toString(),
				toString: function() {
				    return "framerate:" + (that.frameRate == -1 ? " MAX ":that.frameRate ) + " Current frame: " + this.frame + " Timeline: " + this.readableEventTime;
				}
			    };
			    that.enterframeEventQue[i](enventParam);
			}

			if (_requestAF !== null && that.getFrame() == DEFAULTFRM) {
			    _requestAF(step);
			}
			this.lastTime = new Date().getTime();
		    };

		    if (_requestAF !== null && that.getFrame() == DEFAULTFRM) {
			_requestAF(step);
		    } else {
			this.interValHandle = setInterval(step, this.getInterval());
		    }
		    return this;
		};
		_export.fn.extend = function(classFunc) {
		    if (!!(classFunc && classFunc.constructor && classFunc.call && classFunc.apply)) {
			classFunc.prototype.frameEvent = new _export();
			return this;
		    } else {
			throw ERROMESSAGE;
		    }
		};

		_import.prototype.frameEvent = new _export();

	    }(Window));
	</script>

	<script type="text/javascript">
	    /*
	     * Gio = (Aaron Goshine); 
	     */
	    var callback = function() {
	    };
	    var eventHandler = function(event) {
		var windowframe = document.getElementById("windowFrame12");
		windowframe.innerHTML = event.toString();
	    };

	    var classFuncEventHandler_30 = function(event) {
		var classFrames = document.getElementById("classFrames30");
		classFrames.innerHTML = event.toString();
	    };

	    var classFuncEventHandler_60 = function(event) {
		var classFrames = document.getElementById("classFrames60");
		classFrames.innerHTML = event.toString();
	    };

	    var requestAFHandler = function(event) {
		var classFrames = document.getElementById("requestAnimationFrame");
		classFrames.innerHTML = event.toString();
	    };

	    window.onload = function() {
		// frameEvent can becalled on the window by deafult
		window.frameEvent.onEnterFrame("handleFrameOnWindow", eventHandler, callback);
		window.frameEvent.setFrameRate(12);
	
		var Class_RAF = function() {
		};
		//window will extend your class peacefull
		window.frameEvent.extend(Class_RAF);
		var instance = new Class_RAF();
		instance.frameEvent.setFrameRate(-1);
		instance.frameEvent.onEnterFrame("requestAnimationFrame", requestAFHandler);

		var Class_30 = function() {
		};
		//window will extend your class peacefull
		window.frameEvent.extend(Class_30);
		var instance = new Class_30();
		instance.frameEvent.setFrameRate(30);
		instance.frameEvent.onEnterFrame("handleFrameOnClassFunc_30", classFuncEventHandler_30);

		var Class_60 = function() {		
		};
		//window will extend your class peacefull
		window.frameEvent.extend(Class_60);
		var instance = new Class_60();
		instance.frameEvent.setFrameRate(60);
		instance.frameEvent.onEnterFrame("handleFrameOnClassFunc_60", classFuncEventHandler_60);
		//frameEvent.deleteEnterFrame ("handleFrameOnClassFunc_60");

	    };

	</script>
	<style>
	    *{
		font-family: arial;
		color: gray;
	    }
	    .console{

		font-size: 18px;
		margin-bottom:20px;
	    }
	    h2{width: 600px;
	    margin-bottom:10px;
	    }
	    p{
		width: 600px;
		color:darkseagreen;
	    }
	    .recommendation{
		background-color: pink;
		display:inline-block;
		padding: 3px;
		color: red;
	    }
	</style>
    </head>
    <body >
	<h2> window.requestAnimationFrame  is the most efficient way to do animation in HTML5</h2>
	<p>if you do not specify a frame rate  or you explicitly set the frame rate to -1 "instance.frameEvent.setFrameRate(-1);" your animation frames will be played to the maximum capabilities of the browser<span class="recommendation">Highly recommended</span></p>
	<div class="console" id="requestAnimationFrame">
	</div>
	<hr>
	<h2> 12 frames per seconds </h2>
	<p>You can specify frame rate by extending "window.frameEvent.extend(Class_60);" </p>
	<div class="console" id="windowFrame12">
	</div>
	<hr>
	<h2> 30 frames per seconds </h2>
	<div class ="console" id="classFrames30">
	</div>
	<hr>
	<h2> 60 frames per seconds </h2>
	<div class ="console" id="classFrames60">
	</div>

    </body>
</html>
